# Diffusion Maps

## Description
This repositories contains code implementation of the paper "Learning solution operator of dynamical systems with diffusion maps kernel ridge regression", which can be found in https://arxiv.org/abs/2512.17203.

## Table of Contents
- [Installation](#installation)
- [Usage](#usage)
  - [Navigation](#navigation)
  - [Test caes](#testcases)
- [External code](#externalcode)

## Installation
This project uses a Conda environment defined in `environment.yml` (Python 3.9 + NumPy/SciPy/Scikit-learn/Matplotlib, with optional GPU support via CuPy).

### 1) Create the environment
From the repository root:

```text
conda env create -f environment.yml
```

### 2) Activate the environment
```text
conda activate dm_env
```


## Usage

### Navigation
```text
diffusion_maps/
├── data/
│   ├── cached_data/
│   │   ├── ksdata_chaotic_test_NT_12500000_SKP_500000_dt_0.01_ts_10.pkl
│   │   ├── ksdata_chaotic_training_NT_15000000_SKP_500000_dt_0.01_ts_10.pkl
│   │   ├── ksdata_traveling_NT_5000000_SKP_500000_dt_0.001_ts_10.pkl
│   │   ├── ksdataBeatingTraveling.mat
│   │   ├── lorenz_test.npy
│   │   ├── lorenz_train.npy
│   ├── figs/
│   │   └── l63_train.png
│   ├── sphere_torus_utils/
│   │   ├── __init__.py
│   │   ├── sphere_data_gen.py
│   │   ├── sphere_torus_data_gen.py
│   │   ├── sphere_torus_helpers.py
│   │   └── torus_data_gen.py
│   ├── dg_ks_chaotic.py
│   ├── dg_ks_traveling.py
│   ├── dg_l63.py
│   └── dg_torus.py
├── external/
│   ├── data/
│   │   └── deepskip_best_vpts.csv
│   ├── envs/
│   │   ├── candyman_environment.yml
│   │   ├── ldnet_environment.yml
│   │   └── node_environment.yml
│   ├── ks_travel_candyman.py
│   ├── ks_travel_ldnet.py
│   └── ks_travel_node.py
├── src/
│   ├── dm_main.py
│   ├── krr_model.py
│   ├── resDMD.py
│   └── utils.py
├── test/
│   ├── pics/
│   │   ├── lorenz_3d_violin_skip-connection.png
│   │   ├── lorenz_cv_results.png
│   │   ├── torus_cv_results.png
│   │   └── torus_test_rmse.png
│   ├── ks_chaotic_test_case.py
│   ├── ks_figures.ipynb
│   ├── ks_traveling_test_case.py
│   ├── lorenz_figures.ipynb
│   ├── lorenz_test_case.py
│   ├── lorenz_test_case_sensitivity.py
│   ├── ppplate.ipynb
│   ├── ppplate_test_case.py
│   ├── torus_figures.ipynb
│   └── torus_test_case.py
├── trained_mdls/
│   ├── ks_traveling/
│   ├── l63/
│   └── torus/
│
├── .gitignore
├── __init__.py
├── environment.yml
└── README.md
```

### Test cases
There are 5 test cases considered for the paper, and the result of each case can be reproduced by [name]_test_case.py.
- Manifold
  - Torus (torus_test_case.py)
  - KS traveling (ks_traveling_test_case.py)
  - Pitching and plunging flat plate (ppplate_test_case.py)
- Chaotic
  - Lorenz 63 (lorenz_test_case.py)
  - KS chaotic (ks_chaotic_test_case.py)

In each test case script, there are usually two stages; training/validation and test. For KRR model, training simply denotes finding kernel coefficients through kernel matrix inversion (done by Cholesky decomposition). Test is done by rolling out from an unseen initial condition and calculate the error with the truth from the same initial condition.

Note that all the implementations assume 4 available GPUs specified by variable named "device". This has to be changed accoridingly based on the user's available GPU.

The figures are generated by jupyter notebooks, named [name]_figures.py

- Torus (torus_figures.ipynb)
- KS traveling & KS chaotic (ks_figures.ipynb)
- Lorenz 63 (lorenz_figures.ipynb)
- Pitching and plunging flat plate (ppplate.ipynb)

Note that to reproduce the results of Lorenz case, N=512, 1024 cases are generated by the lorenz_test_case_sensitivity.py. If you run lorenz_test_case.py, you will get slightly different result simply due to the fact that it has different choice of validation trajectory.


## External code
There are three external models used for the paper, CANDyMAN, LDNet and NODE. They are used for learning Kuramoto-Sivashinsky traveling dynamics, and the codes are located in the directory named external.  The Python environment used for each model can be generated by the .yml files in envs directory.

